<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>漢字冒険 - Player Records</title>

    <script>
        (function () {
            const savedTheme = localStorage.getItem("kanjiQuestTheme") || "theme-tsukizumi";
            document.documentElement.classList.add(savedTheme);
        })();
    </script>

    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Outfit:wght@400;700&display=swap"
        rel="stylesheet" />
    <link rel="shortcut icon" href="../Assets/japanese-gate.png" type="image/x-icon" />
    <link rel="stylesheet" href="../CSS/style.css" />
    <link rel="stylesheet" href="../CSS/themes.css" />
    <link rel="stylesheet" href="../CSS/animation.css" />

    <script src="../JS/animate.js"></script>
    <script src="../JS/script.js" defer></script>

    <!-- ✨ Self-contained styles for the scoreboard only -->
    <style>
        /* Container */
        .pr-wrapper {
            max-width: 1100px;
            margin: 24px auto 96px;
            padding: 0 16px;
        }

        .pr-card {
            background: color-mix(in srgb, var(--card-bg, #1f1f1f) 88%, transparent);
            backdrop-filter: blur(8px);
            border: 1px solid color-mix(in srgb, var(--card-bg, #1f1f1f), #ffffff 12%);
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.25);
            overflow: clip;
        }

        .pr-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 18px 20px;
            border-bottom: 1px solid color-mix(in srgb, var(--card-bg, #1f1f1f), #ffffff 10%);
        }

        .pr-title {
            display: flex;
            align-items: baseline;
            gap: 10px;
        }

        .pr-title h2 {
            font-family: 'Outfit', 'Noto Sans JP', system-ui, sans-serif;
            font-weight: 700;
            letter-spacing: .2px;
            font-size: clamp(18px, 2vw, 22px);
            color: var(--text-color, #f4f1de);
            margin: 0;
        }

        .pr-sub {
            color: var(--muted, #8d8d8d);
            font-size: 12px;
        }

        /* Controls */
        .pr-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .pr-input,
        .pr-select,
        .pr-button {
            height: 38px;
            padding: 8px 12px;
            border-radius: 12px;
            border: 1px solid var(--input-border, #444);
            background: var(--input-bg, #292929);
            color: var(--text-color, #f4f1de);
            outline: none;
            transition: transform .15s ease, box-shadow .2s ease, border-color .2s ease;
        }

        .pr-input::placeholder {
            color: var(--placeholder-color, #bfbfbf);
        }

        .pr-input:focus,
        .pr-select:focus {
            border-color: var(--input-border-focus, rgba(239, 131, 84, .3));
            box-shadow: 0 0 0 6px var(--input-box-shadow, rgba(239, 131, 84, .1));
        }

        .pr-button {
            border: 1px solid color-mix(in srgb, var(--primary-color, #ef8354), #ffffff 10%);
            background: linear-gradient(180deg,
                    color-mix(in srgb, var(--primary-color, #ef8354) 82%, transparent),
                    color-mix(in srgb, var(--primary-color, #ef8354) 60%, #000 12%));
            color: #fff;
            font-weight: 700;
            cursor: pointer;
        }

        .pr-button:hover {
            transform: translateY(-1px);
        }

        /* Table-like list */
        .pr-list {
            display: grid;
            grid-template-columns: 1fr;
        }

        .pr-row {
            position: relative;
            display: grid;
            grid-template-columns: 64px 1.1fr 0.8fr 0.8fr 0.8fr 120px;
            gap: 12px;
            align-items: center;
            padding: 14px 20px;
            overflow: hidden;
            isolation: isolate;
        }

        /* Animated score glow behind row */
        .pr-row::before {
            content: "";
            position: absolute;
            inset: 0;
            background:
                radial-gradient(1200px 60px at var(--barX, -40%) 100%,
                    color-mix(in srgb, var(--accent-color, #ffd6a5) 20%, transparent),
                    transparent 60%);
            opacity: 0;
            transform: translateY(10px);
            transition: opacity .35s ease, transform .35s ease;
            z-index: 0;
        }

        .pr-row:hover::before {
            opacity: .65;
            transform: translateY(0);
        }

        .pr-row+.pr-row {
            border-top: 1px dashed color-mix(in srgb, var(--card-bg, #1f1f1f), #ffffff 8%);
        }

        .pr-rank {
            font-weight: 800;
            font-size: 18px;
            color: var(--accent-color, #ffd6a5);
            text-align: center;
            width: 44px;
        }

        .pr-player {
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 0;
        }

        .pr-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background:
                radial-gradient(circle at 30% 20%,
                    color-mix(in srgb, var(--primary-color, #ef8354), #ffffff 20%),
                    var(--primary-color, #ef8354));
            display: grid;
            place-items: center;
            font-weight: 900;
            color: #fff;
            box-shadow: 0 6px 20px rgba(0, 0, 0, .35);
            transform: translateZ(0);
        }

        .pr-name {
            font-weight: 700;
            color: var(--text-color, #f4f1de);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .pr-badges {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .pr-badge {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 999px;
            border: 1px solid color-mix(in srgb, var(--accent-color, #ffd6a5), #ffffff 15%);
            background: color-mix(in srgb, var(--accent-color, #ffd6a5) 22%, transparent);
            color: color-mix(in srgb, var(--accent-color, #ffd6a5) 65%, #000);
            font-weight: 700;
        }

        .pr-metric {
            color: var(--text-color, #f4f1de);
            font-variant-numeric: tabular-nums;
            opacity: .95;
        }

        .pr-metric small {
            color: var(--muted, #8d8d8d);
            font-size: 11px;
            display: block;
        }

        /* Score pill with progress */
        .pr-score {
            justify-self: end;
            display: inline-grid;
            grid-auto-flow: column;
            gap: 8px;
            align-items: center;
            padding: 8px 12px;
            border-radius: 999px;
            border: 1px solid color-mix(in srgb, var(--primary-color, #ef8354), #ffffff 18%);
            background: linear-gradient(180deg,
                    color-mix(in srgb, var(--primary-color, #ef8354) 16%, transparent),
                    color-mix(in srgb, var(--primary-color, #ef8354) 10%, #000 10%));
        }

        .pr-score-value {
            font-weight: 900;
            letter-spacing: .4px;
        }

        .pr-bar {
            position: relative;
            width: 80px;
            height: 8px;
            border-radius: 999px;
            background: color-mix(in srgb, var(--card-bg, #1f1f1f), #ffffff 10%);
            overflow: hidden;
        }

        .pr-bar>span {
            position: absolute;
            inset: 0 100% 0 0;
            border-radius: inherit;
            background: linear-gradient(90deg,
                    var(--accent-color, #ffd6a5),
                    color-mix(in srgb, var(--primary-color, #ef8354), var(--accent-color, #ffd6a5) 40%));
            transition: inset .9s cubic-bezier(.2, .8, .2, 1);
        }

        /* Row entrance animation */
        @keyframes pr-fade-up {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .pr-row {
            animation: pr-fade-up .5s both;
        }

        /* Sticky header row labels (mobile hidden) */
        .pr-head {
            position: sticky;
            top: 0;
            z-index: 1;
            background: linear-gradient(180deg,
                    color-mix(in srgb, var(--card-bg, #1f1f1f) 96%, transparent),
                    color-mix(in srgb, var(--card-bg, #1f1f1f) 92%, transparent));
            border-bottom: 1px solid color-mix(in srgb, var(--card-bg, #1f1f1f), #ffffff 10%);
            backdrop-filter: blur(6px);
        }

        .pr-head span {
            color: var(--muted, #8d8d8d);
            font-size: 12px;
            font-weight: 700;
        }

        /* Mobile */
        @media (max-width: 820px) {
            .pr-row {
                grid-template-columns: 44px 1fr auto;
                gap: 10px;
            }

            .pr-hide-md {
                display: none;
            }

            .pr-score {
                justify-self: start;
            }
        }

        /* Tiny hover lift */
        .pr-row:hover {
            transform: translateY(-1px);
            transition: transform .15s ease;
        }
    </style>
</head>

<body>
    <header>
        <h1>漢字冒険</h1>
        <button class="header-btn" onclick="window.location.href='../index.html'">戻る</button>
    </header>

    <div class="snow-animation"></div>
    <div class="sakura-animation"></div>

    <!-- ⭐ Player Records / Scoreboard (add-on, non-breaking) -->
    <main class="pr-wrapper" aria-label="Player Records">
        <section class="pr-card" id="playerRecords">
            <div class="pr-header">
                <div class="pr-title">
                    <h2>記録盤</h2>
                    <span class="pr-sub">プレイヤーの成績と進捗</span>
                </div>
                <div class="pr-controls">
                    <input id="prSearch" class="pr-input" type="search" placeholder="プレイヤー検索…"
                        aria-label="Search players" />
                    <select id="prSort" class="pr-select" aria-label="Sort by">
                        <option value="score">スコア順</option>
                        <option value="streak">連続日数順</option>
                        <option value="accuracy">正答率順</option>
                        <option value="time">最終プレイ順</option>
                    </select>
                    <button id="prRefresh" class="pr-button" type="button">更新</button>
                </div>
            </div>

            <!-- Column labels -->
            <div class="pr-row pr-head pr-hide-md">
                <span class="pr-rank">#</span>
                <span>プレイヤー</span>
                <span>連続日数</span>
                <span>正答率</span>
                <span>総プレイ</span>
                <span class="pr-hide-md" style="text-align:right;">スコア</span>
            </div>

            <div class="pr-list" id="prList" role="list"></div>
        </section>
    </main>

    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-sections">
                <div class="footer-section">
                    <ul>
                        <li><a href="../index.html">初頁</a></li>
                        <li><a href="heatmap.html">熱図</a></li>
                        <li><a href="player-records.html">記録</a></li>
                        <li><a href="#">自己</a></li>
                        <li><a href="#">試練</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p>© 2025 漢字冒険 - Kanji Quest. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        (function () {
            // If your app provides real data, set window.playerRecords before this script runs.
            // Each item: { name, score(0-1000+), streak, accuracy(0-100), plays, lastPlayed ISO }
            const sample = [
                { name: "Timmy", score: 982, streak: 21, accuracy: 97, plays: 412, lastPlayed: "2025-08-22T20:11:00Z" },
                { name: "BlazingJess", score: 951, streak: 15, accuracy: 94, plays: 366, lastPlayed: "2025-08-23T00:20:00Z" },
                { name: "KanaKaiser", score: 905, streak: 9, accuracy: 92, plays: 295, lastPlayed: "2025-08-21T17:00:00Z" },
                { name: "SakuraDrift", score: 880, streak: 13, accuracy: 89, plays: 332, lastPlayed: "2025-08-22T10:45:00Z" },
                { name: "YomiSensei", score: 842, streak: 7, accuracy: 91, plays: 251, lastPlayed: "2025-08-19T14:12:00Z" },
                { name: "OnyomiPro", score: 799, streak: 11, accuracy: 88, plays: 220, lastPlayed: "2025-08-20T19:31:00Z" },
                { name: "KunReader", score: 752, streak: 4, accuracy: 85, plays: 198, lastPlayed: "2025-08-18T09:27:00Z" },
                { name: "RadicalAce", score: 706, streak: 5, accuracy: 82, plays: 173, lastPlayed: "2025-08-17T22:08:00Z" }
            ];

            const data = Array.isArray(window.playerRecords) ? window.playerRecords : sample;

            const list = document.getElementById('prList');
            const search = document.getElementById('prSearch');
            const sortSel = document.getElementById('prSort');
            const btn = document.getElementById('prRefresh');

            const fmt = {
                percent(v) { return `${Math.round(v)}%`; },
                number(v) { return v.toLocaleString(); },
                days(v) { return `${v}日`; },
                timeago(iso) {
                    try {
                        const d = new Date(iso);
                        const diff = (Date.now() - d.getTime()) / 1000;
                        if (diff < 60) return "たった今";
                        if (diff < 3600) return `${Math.floor(diff / 60)}分前`;
                        if (diff < 86400) return `${Math.floor(diff / 3600)}時間前`;
                        return `${Math.floor(diff / 86400)}日前`;
                    } catch { return ""; }
                }
            };

            function initials(name) {
                return name.split(/\s+/).map(p => p[0]?.toUpperCase()).join('').slice(0, 2) || "?";
            }

            function paint(rows) {
                list.innerHTML = "";
                rows.forEach((p, i) => {
                    const row = document.createElement('div');
                    row.className = 'pr-row';
                    row.style.setProperty('--barX', `${Math.min(100, (p.score % 1000) / 10)}%`);
                    row.style.animationDelay = `${i * 40}ms`;

                    const rank = document.createElement('div');
                    rank.className = 'pr-rank';
                    rank.textContent = i + 1;

                    const player = document.createElement('div');
                    player.className = 'pr-player';
                    player.innerHTML = `
            <div class="pr-avatar" aria-hidden="true">${initials(p.name)}</div>
            <div style="min-width:0">
              <div class="pr-name">${p.name}</div>
              <div class="pr-badges">
                <span class="pr-badge">最終: ${fmt.timeago(p.lastPlayed)}</span>
              </div>
            </div>
          `;

                    const streak = document.createElement('div');
                    streak.className = 'pr-metric pr-hide-md';
                    streak.innerHTML = `<strong>${fmt.days(p.streak)}</strong><small>連続</small>`;

                    const acc = document.createElement('div');
                    acc.className = 'pr-metric pr-hide-md';
                    acc.innerHTML = `<strong>${fmt.percent(p.accuracy)}</strong><small>正答率</small>`;

                    const plays = document.createElement('div');
                    plays.className = 'pr-metric pr-hide-md';
                    plays.innerHTML = `<strong>${fmt.number(p.plays)}</strong><small>総プレイ</small>`;

                    const score = document.createElement('div');
                    score.className = 'pr-score';
                    const pct = Math.max(0, Math.min(100, (p.score / 1000) * 100));
                    score.innerHTML = `
            <span class="pr-score-value">${fmt.number(p.score)}</span>
            <div class="pr-bar" role="progressbar" aria-valuenow="${Math.round(pct)}" aria-valuemin="0" aria-valuemax="100">
              <span style="inset: 0 ${100 - pct}% 0 0"></span>
            </div>
          `;

                    row.append(rank, player, streak, acc, plays, score);
                    list.appendChild(row);
                });
            }

            function sortBy(key, rows) {
                const copy = [...rows];
                switch (key) {
                    case 'streak': copy.sort((a, b) => b.streak - a.streak); break;
                    case 'accuracy': copy.sort((a, b) => b.accuracy - a.accuracy); break;
                    case 'time': copy.sort((a, b) => new Date(b.lastPlayed) - new Date(a.lastPlayed)); break;
                    default: copy.sort((a, b) => b.score - a.score); break;
                }
                return copy;
            }

            let current = sortBy(sortSel.value, data);
            paint(current);

            // Interactions
            sortSel.addEventListener('change', () => {
                current = sortBy(sortSel.value, current);
                paint(current);
            });

            search.addEventListener('input', () => {
                const q = search.value.trim().toLowerCase();
                const filtered = (q ? current.filter(p => p.name.toLowerCase().includes(q)) : current);
                paint(filtered);
            });

            btn.addEventListener('click', () => {
                // Cute refresh wiggle
                btn.animate([{ transform: 'rotate(0deg)' }, { transform: 'rotate(360deg)' }], { duration: 500, easing: 'ease' });
                // Re-apply sort (useful if external data was updated)
                current = sortBy(sortSel.value, Array.isArray(window.playerRecords) ? window.playerRecords : data);
                paint(current);
            });

            // Animate progress bars on first reveal
            const io = new IntersectionObserver((entries) => {
                entries.forEach(e => {
                    if (e.isIntersecting) {
                        e.target.querySelectorAll('.pr-bar > span').forEach(span => {
                            span.style.transitionDuration = '900ms';
                        });
                    }
                });
            }, { threshold: 0.2 });
            io.observe(document.getElementById('playerRecords'));
        })();
    </script>
</body>

</html>