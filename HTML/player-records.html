<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>漢字冒険 - プレイヤー記録</title>

    <script>
        (function () {
            const savedTheme = localStorage.getItem("kanjiQuestTheme") || "theme-tsukizumi";
            document.documentElement.classList.add(savedTheme);
        })();
    </script>

    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Outfit:wght@400;700&display=swap"
        rel="stylesheet" />
    <link rel="shortcut icon" href="../Assets/japanese-gate.png" type="image/x-icon" />
    <link rel="stylesheet" href="../CSS/style.css" />
    <link rel="stylesheet" href="../CSS/themes.css" />
    <link rel="stylesheet" href="../CSS/animation.css" />

    <script src="../JS/animate.js"></script>
    <script src="../JS/script.js" defer></script>

    <style>
        .scoreboard-wrapper {
            max-width: 1200px;
            width: 50%;
            margin: 2rem auto 4rem;
            padding: 0 16px;
            max-height: 100vh;
        }

        .scoreboard-card {
            background: color-mix(in srgb, var(--card-bg, #1f1f1f) 88%, transparent);
            backdrop-filter: blur(8px);
            border: 1px solid color-mix(in srgb, var(--card-bg, #1f1f1f), #ffffff 12%);
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.25);
            overflow: clip;
            padding-bottom: 10px;
            margin-top: 0.5rem;
        }

        .scoreboard-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding: 18px 20px;
            border-bottom: 1px solid color-mix(in srgb, var(--card-bg, #1f1f1f), #ffffff 10%);
        }

        .scoreboard-title {
            display: flex;
            align-items: baseline;
            gap: 10px;
        }

        .scoreboard-title h2 {
            font-family: 'Outfit', 'Noto Sans JP', system-ui, sans-serif;
            font-weight: 700;
            letter-spacing: .2px;
            font-size: clamp(18px, 2vw, 22px);
            color: var(--text-color, #f4f1de);
            margin: 0;
        }

        .scoreboard-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .scoreboard-input,
        .scoreboard-button {
            height: 38px;
            padding: 8px 12px;
            border-radius: 12px;
            border: 1px solid var(--input-border, #444);
            background: var(--input-bg, #292929);
            color: var(--text-color, #f4f1de);
            outline: none;
            transition: transform .15s ease, box-shadow .2s ease, border-color .2s ease;
        }

        .scoreboard-select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-color: var(--input-bg);
            border: 1px solid var(--input-border);
            color: var(--text-color);
            padding: 8px 32px 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            background-image: url("data:image/svg+xml;utf8,<svg fill='%23f4f1de' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><path d='M7 10l5 5 5-5z'/></svg>");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px;
        }

        .scoreboard-select:hover,
        .scoreboard-select:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .scoreboard-input::placeholder {
            color: var(--placeholder-color, #bfbfbf);
        }

        .scoreboard-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow:
                0 0 0 4px rgba(var(--primary-color-rgb), 0.15),
                0 0 20px 4px rgba(var(--primary-color-rgb), 0.25),
                inset 0 1px 5px rgba(255, 255, 255, 0.2);
            transform: scale(1.01);
        }

        .scoreboard-button {
            border: 1px solid color-mix(in srgb, var(--primary-color, #ef8354), #ffffff 10%);
            background: linear-gradient(180deg,
                    color-mix(in srgb, var(--primary-color, #ef8354) 82%, transparent),
                    color-mix(in srgb, var(--primary-color, #ef8354) 60%, #000 12%));
            color: #fff;
            font-weight: 700;
            cursor: pointer;
        }

        .scoreboard-button:hover {
            transform: translateY(-1px);
        }

        .scoreboard-input::-webkit-search-cancel-button {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background-color: var(--accent-color);
            mask: url('data:image/svg+xml;utf8,<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><line x1="4" y1="4" x2="16" y2="16" stroke="white" stroke-width="2"/><line x1="16" y1="4" x2="4" y2="16" stroke="white" stroke-width="2"/></svg>') no-repeat center / contain;
            cursor: pointer;
        }

        .scoreboard-input::-webkit-search-cancel-button:hover {
            background-color: var(--primary-color);
        }

        .scoreboard-list {
            display: grid;
            grid-template-columns: 1fr;
        }

        .scoreboard-row {
            position: relative;
            display: grid;
            grid-template-columns: 64px 1.4fr 1fr 1fr 120px;
            gap: 12px;
            align-items: center;
            padding: 14px 20px;
            overflow: hidden;
            isolation: isolate;
        }

        .scoreboard-row::before {
            content: "";
            position: absolute;
            inset: 0;
            background:
                radial-gradient(1200px 60px at var(--barX, -40%) 100%,
                    color-mix(in srgb, var(--accent-color, #ffd6a5) 20%, transparent),
                    transparent 60%);
            opacity: 0;
            transform: translateY(10px);
            transition: opacity .35s ease, transform .35s ease;
            z-index: 0;
        }

        .scoreboard-row:hover::before {
            opacity: .65;
            transform: translateY(0);
        }

        .scoreboard-row+.scoreboard-row {
            border-top: 1px dashed color-mix(in srgb, var(--card-bg, #1f1f1f), #ffffff 8%);
        }

        .scoreboard-rank {
            font-weight: 800;
            font-size: 18px;
            color: var(--accent-color, #ffd6a5);
            text-align: center;
            width: 44px;
        }

        .scoreboard-player {
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 0;
        }

        .scoreboard-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background:
                radial-gradient(circle at 30% 20%,
                    color-mix(in srgb, var(--primary-color, #ef8354), #ffffff 20%),
                    var(--primary-color, #ef8354));
            display: grid;
            place-items: center;
            font-weight: 900;
            color: #fff;
            box-shadow: 0 6px 20px rgba(0, 0, 0, .35);
            transform: translateZ(0);
        }

        .scoreboard-name {
            font-weight: 700;
            color: var(--text-color, #f4f1de);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .scoreboard-badges {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .scoreboard-badges span {
            color: var(--accent-color);
        }

        .scoreboard-badge {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 999px;
            border: 1px solid color-mix(in srgb, var(--accent-color, #ffd6a5), #ffffff 15%);
            background: color-mix(in srgb, var(--accent-color, #ffd6a5) 22%, transparent);
            color: color-mix(in srgb, var(--accent-color, #ffd6a5) 65%, #000);
            font-weight: 700;
            margin-top: 7px;
        }

        .scoreboard-metric {
            color: var(--text-color, #f4f1de);
            font-variant-numeric: tabular-nums;
            opacity: .95;
        }

        .scoreboard-metric small {
            color: var(--muted, #8d8d8d);
            font-size: 11px;
            display: block;
        }

        .scoreboard-score {
            justify-self: end;
            display: inline-grid;
            grid-auto-flow: column;
            gap: 8px;
            align-items: center;
            padding: 8px 12px;
            border-radius: 999px;
            border: 1px solid color-mix(in srgb, var(--primary-color, #ef8354), #ffffff 18%);
            background: linear-gradient(180deg,
                    color-mix(in srgb, var(--primary-color, #ef8354) 16%, transparent),
                    color-mix(in srgb, var(--primary-color, #ef8354) 10%, #000 10%));
        }

        .scoreboard-score-value {
            font-weight: 900;
            letter-spacing: .4px;
        }

        .scoreboard-bar {
            position: relative;
            width: 80px;
            height: 8px;
            border-radius: 999px;
            background: color-mix(in srgb, var(--card-bg, #1f1f1f), #ffffff 10%);
            overflow: hidden;
        }

        .scoreboard-bar>span {
            position: absolute;
            inset: 0 100% 0 0;
            border-radius: inherit;
            background: linear-gradient(90deg,
                    var(--accent-color, #ffd6a5),
                    color-mix(in srgb, var(--primary-color, #ef8354), var(--accent-color, #ffd6a5) 40%));
            transition: inset .9s cubic-bezier(.2, .8, .2, 1);
        }

        .scoreboard-row {
            animation: scoreboard-fade-up .5s both;
        }

        .scoreboard-head {
            position: sticky;
            top: 0;
            z-index: 1;
            background: linear-gradient(180deg,
                    color-mix(in srgb, var(--card-bg, #1f1f1f) 96%, transparent),
                    color-mix(in srgb, var(--card-bg, #1f1f1f) 92%, transparent));
            border-bottom: 1px solid color-mix(in srgb, var(--card-bg, #1f1f1f), #ffffff 10%);
            backdrop-filter: blur(6px);
            display: grid;
            grid-template-columns: 64px 1.4fr 1fr 1fr 120px;
        }

        .scoreboard-head span {
            color: var(--muted, #8d8d8d);
            font-size: 12px;
            font-weight: 700;
        }

        @media (max-width: 820px) {
            .scoreboard-row {
                grid-template-columns: 44px 1fr auto;
                gap: 10px;
            }

            .scoreboard-hide-md {
                display: none;
            }

            .scoreboard-score {
                justify-self: start;
            }
        }

        .scoreboard-row:hover {
            transform: translateY(-1px);
            transition: transform .15s ease;
        }
    </style>
</head>

<body>
    <header class="main-navbar">
        <div class="navbar-left">
            <h1 class="app-title"><a href="../index.html">漢字冒険</a></h1>
        </div>
        <button class="header-btn" onclick="window.location.href='../index.html'">戻る</button>
    </header>

    <main class="scoreboard-wrapper" aria-label="Player Records">
        <section class="scoreboard-card" id="scoreboard">
            <div class="scoreboard-header">
                <div class="scoreboard-title">
                    <h2>記録盤</h2>
                </div>
                <div class="scoreboard-controls">
                    <input id="scoreboardSearch" class="scoreboard-input" type="search" placeholder="プレイヤー検索…"
                        aria-label="Search players" />
                    <select id="scoreboardSort" class="scoreboard-select" aria-label="Sort by">
                        <option value="score">スコア順</option>
                        <option value="streak">連続日数順</option>
                        <option value="accuracy">正答率順</option>
                        <option value="time">最終プレイ順</option>
                    </select>
                    <button id="scoreboardRefresh" class="scoreboard-button" type="button">更新</button>
                </div>
            </div>

            <div class="scoreboard-row scoreboard-head scoreboard-hide-md">
                <span class="scoreboard-rank">#</span>
                <span style="text-align: center; margin-right: 100px;">プレイヤー</span>
                <span>連続日数</span>
                <span>正答率</span>
                <span class="scoreboard-hide-md" style="text-align:center; margin-right: 20px;">スコア</span>
            </div>

            <div class="scoreboard-list" id="scoreboardList" role="list"></div>
        </section>
    </main>

    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-sections">
                <div class="footer-section">
                    <ul>
                        <li><a href="../index.html">初頁</a></li>
                        <li><a href="heatmap.html">熱図</a></li>
                        <li><a href="player-records.html">記録</a></li>
                        <li><a href="#">自己</a></li>
                        <li><a href="#">試練</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <p>© 2025 漢字冒険 - Kanji Quest. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        (function () {
            const samplePlayers = [
                { name: "Anna", score: 982, streak: 21, accuracy: 97, lastPlayed: "2025-08-22T20:11:00Z" },
                { name: "Timmy", score: 951, streak: 15, accuracy: 94, lastPlayed: "2025-08-23T00:20:00Z" },
                { name: "Pinchobo", score: 905, streak: 9, accuracy: 92, lastPlayed: "2025-08-21T17:00:00Z" },
                { name: "Moe", score: 880, streak: 13, accuracy: 89, lastPlayed: "2025-08-22T10:45:00Z" },
                { name: "Jim", score: 842, streak: 7, accuracy: 91, lastPlayed: "2025-08-19T14:12:00Z" },
                { name: "Emily", score: 799, streak: 11, accuracy: 88, lastPlayed: "2025-08-20T19:31:00Z" },
            ];

            const players = Array.isArray(window.playerRecords) ? window.playerRecords : samplePlayers;

            const listEl = document.getElementById('scoreboardList');
            const searchEl = document.getElementById('scoreboardSearch');
            const sortEl = document.getElementById('scoreboardSort');
            const refreshBtn = document.getElementById('scoreboardRefresh');

            const format = {
                percent(v) { return `${Math.round(v)}%`; },
                days(v) { return `${v}日`; },
                timeago(iso) {
                    try {
                        const d = new Date(iso);
                        const diff = (Date.now() - d.getTime()) / 1000;
                        if (diff < 60) return "たった今";
                        if (diff < 3600) return `${Math.floor(diff / 60)}分前`;
                        if (diff < 86400) return `${Math.floor(diff / 3600)}時間前`;
                        return `${Math.floor(diff / 86400)}日前`;
                    } catch { return ""; }
                }
            };

            function initials(name) {
                return name.split(/\s+/).map(p => p[0]?.toUpperCase()).join('').slice(0, 2) || "?";
            }

            function renderScoreboard(rows) {
                listEl.innerHTML = "";
                rows.forEach((player, i) => {
                    const row = document.createElement('div');
                    row.className = 'scoreboard-row';
                    row.style.setProperty('--barX', `${Math.min(100, (player.score % 1000) / 10)}%`);
                    row.style.animationDelay = `${i * 40}ms`;

                    const rank = document.createElement('div');
                    rank.className = 'scoreboard-rank';
                    rank.textContent = i + 1;

                    const playerEl = document.createElement('div');
                    playerEl.className = 'scoreboard-player';
                    playerEl.innerHTML = `
                        <div class="scoreboard-avatar" aria-hidden="true">${initials(player.name)}</div>
                        <div style="min-width:0">
                            <div class="scoreboard-name">${player.name}</div>
                            <div class="scoreboard-badges">
                                <span class="scoreboard-badge">最終: ${format.timeago(player.lastPlayed)}</span>
                            </div>
                        </div>
                    `;

                    const streak = document.createElement('div');
                    streak.className = 'scoreboard-metric scoreboard-hide-md';
                    streak.innerHTML = `<strong>${format.days(player.streak)}</strong><small>連続</small>`;

                    const acc = document.createElement('div');
                    acc.className = 'scoreboard-metric scoreboard-hide-md';
                    acc.innerHTML = `<strong>${format.percent(player.accuracy)}</strong><small>正答率</small>`;

                    const score = document.createElement('div');
                    score.className = 'scoreboard-score';
                    const pct = Math.max(0, Math.min(100, (player.score / 1000) * 100));
                    score.innerHTML = `
                        <span class="scoreboard-score-value">${player.score}</span>
                        <div class="scoreboard-bar" role="progressbar" aria-valuenow="${Math.round(pct)}" aria-valuemin="0" aria-valuemax="100">
                            <span style="inset: 0 ${100 - pct}% 0 0"></span>
                        </div>
                    `;

                    row.append(rank, playerEl, streak, acc, score);
                    listEl.appendChild(row);
                });
            }

            function sortPlayers(byKey, dataList) {
                const copy = [...dataList];
                switch (byKey) {
                    case 'streak': copy.sort((a, b) => b.streak - a.streak); break;
                    case 'accuracy': copy.sort((a, b) => b.accuracy - a.accuracy); break;
                    case 'time': copy.sort((a, b) => new Date(b.lastPlayed) - new Date(a.lastPlayed)); break;
                    default: copy.sort((a, b) => b.score - a.score); break;
                }
                return copy;
            }

            let currentPlayers = sortPlayers(sortEl.value, players);
            renderScoreboard(currentPlayers);

            sortEl.addEventListener('change', () => {
                currentPlayers = sortPlayers(sortEl.value, currentPlayers);
                renderScoreboard(currentPlayers);
            });

            searchEl.addEventListener('input', () => {
                const query = searchEl.value.trim().toLowerCase();
                const filtered = (query ? currentPlayers.filter(p => p.name.toLowerCase().includes(query)) : currentPlayers);
                renderScoreboard(filtered);
            });

            refreshBtn.addEventListener('click', () => {
                refreshBtn.animate([{ transform: 'rotate(0deg)' }, { transform: 'rotate(360deg)' }], { duration: 500, easing: 'ease' });
                currentPlayers = sortPlayers(sortEl.value, Array.isArray(window.playerRecords) ? window.playerRecords : players);
                renderScoreboard(currentPlayers);
            });

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(e => {
                    if (e.isIntersecting) {
                        e.target.querySelectorAll('.scoreboard-bar > span').forEach(span => {
                            span.style.transitionDuration = '900ms';
                        });
                    }
                });
            }, { threshold: 0.2 });

            observer.observe(document.getElementById('scoreboard'));
        })();
    </script>
</body>

</html>